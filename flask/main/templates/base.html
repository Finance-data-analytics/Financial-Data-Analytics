<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">


    <!-- Bootstrap Multiselect CSS -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/css/bootstrap-multiselect.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap Bundle -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>

    <!-- Bootstrap Multiselect -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.16/js/bootstrap-multiselect.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

    <title>
        {% block title %}
        {% endblock %}
    </title>
</head>
<body>

<!-- Navbar here -->
<nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <a class="navbar-brand" href="{{ url_for('main.querry_home_page') }}">Apentis</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item {{ 'active' if request.endpoint == 'main.querry_home_page' else '' }}">
                <a class="nav-link" href="{{ url_for('main.querry_home_page') }}">Query</a>
            </li>
            <li class="nav-item {{ 'active' if request.endpoint == 'main.schedule_querry' else '' }}">
                <a class="nav-link" href="{{ url_for('main.schedule_querry') }}">Schedule</a>
            </li>
            <li class="nav-item {{ 'active' if request.endpoint == 'main.Results' else '' }}">
                <a class="nav-link" href="{{ url_for('main.Results') }}">Results</a>
            </li>
            <li class="nav-item {{ 'active' if request.endpoint == 'main.jobs' else '' }}">
                <a class="nav-link" href="{{ url_for('main.jobs') }}">Jobs</a>
            </li>
        </ul>
        <ul class="navbar-nav">
            <li class="nav-item active">
                <form action="/shutdown" method="post">
                    <input type="submit" value="Shutdown Server">
                </form>
            </li>
        </ul>
        <ul class="navbar-nav">
            <li class="nav-item active">
                <a class="nav-link" href="{{ url_for('main.add_querry') }}">Add Querry</a>
            </li>
        </ul>
    </div>
</nav>
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-bs-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}


{% block content %}

{% endblock %}


</body>
<style>
    textarea.form-control{
        border-radius: 10px
    }
    input[type="submit"] {
        background-color: #dc3545;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 30px;
        margin-right: 30px;
    }

    input[type="submit"]:hover {
        background-color: darkred;
    }
    {% block style %}

    {% endblock %}
</style>
<script>
    {% block JS %}

    {% endblock %}
</script>
<script>
    {% block JS2 %}
    {% endblock %}
</script>
<script>
    $(document).ready(function () {
        window.setTimeout(function () {
            $(".alert").fadeTo(500, 0).slideUp(500, function () {
                $(this).remove();
            });
        }, 5000);

        function toggleIntradayElements(executionId, showIntraday, showMultiIntraday) {
            const executionDetailsIntraday = document.getElementById('executionDetailsIntraday_' + executionId);
            const executionDetailsNotIntraday = document.getElementById('executionDetailsNotIntraday_' + executionId);
            const executionDetailsMultiIntraday = document.getElementById('executionDetails_Multi_Intraday_' + executionId);

            if (showIntraday) {
                executionDetailsIntraday.style.display = 'block';
                executionDetailsNotIntraday.style.display = 'none';
                executionDetailsMultiIntraday.style.display = 'none';
            } else if (showMultiIntraday) {
                executionDetailsIntraday.style.display = 'none';
                executionDetailsNotIntraday.style.display = 'none';
                executionDetailsMultiIntraday.style.display = 'block';
            } else {
                executionDetailsIntraday.style.display = 'none';
                executionDetailsNotIntraday.style.display = 'block';
                executionDetailsMultiIntraday.style.display = 'none';
            }
        }

        {% for execution in executions %}
        const intradayCheckbox_{{ execution.Id }} = document.getElementById('Intraday_Schedule_home_{{ execution.Id }}');
        const notIntradayCheckbox_{{ execution.Id }} = document.getElementById('Is_not_Intraday_home_{{ execution.Id }}');
        const MultiIntradayCheckbox_{{ execution.Id }} = document.getElementById('Multi-Intraday_home_{{ execution.Id }}');

        intradayCheckbox_{{ execution.Id }}.addEventListener('change', function () {
            toggleIntradayElements({{ execution.Id }}, this.checked, false);
        });

        notIntradayCheckbox_{{ execution.Id }}.addEventListener('change', function () {
            toggleIntradayElements({{ execution.Id }}, false, false);
        });

        MultiIntradayCheckbox_{{ execution.Id }}.addEventListener('change', function () {
            toggleIntradayElements({{ execution.Id }}, false, this.checked);
        });

        // Initial setup
        toggleIntradayElements({{ execution.Id }}, intradayCheckbox_{{ execution.Id }}.checked, MultiIntradayCheckbox_{{ execution.Id }}.checked);
        {% endfor %}

        function displayElementsModal(executionId) {
            const frequencyInput = document.getElementById('frequency_modal' + executionId);
            const weeklyDiv = document.getElementById('weekly_modal_day' + executionId);
            const dailyDiv = document.getElementById('days_daily'+ executionId);

            if (frequencyInput.value === 'weekly') {
                weeklyDiv.style.display = 'block';
                dailyDiv.style.display = 'none';
            }
            if (frequencyInput.value === 'daily') {
                weeklyDiv.style.display = 'none';
                dailyDiv.style.display = 'block';
            }
        }

        {% for execution in executions %}
            displayElementsModal('{{ execution.Id }}');
        {% endfor %}



        function toggleIntradayElementsModal(executionId, showIntraday, showMultiIntraday, showNotIntraday) {
            const executionDetailsIntradayModal = document.getElementById('executionDetailsIntradayModal_' + executionId);
            const executionDetailsNotIntradayModal = document.getElementById('executionDetailsNotIntradayModal_' + executionId);
            const executionDetailsMultiIntradayModal = document.getElementById('executionDetailsMultiIntradayModal_' + executionId);

            if (showIntraday) {
                executionDetailsIntradayModal.style.display = 'block';
                executionDetailsNotIntradayModal.style.display = 'none';
                executionDetailsMultiIntradayModal.style.display = 'none';
            } else if (showMultiIntraday) {
                executionDetailsMultiIntradayModal.style.display = 'block';
                executionDetailsIntradayModal.style.display = 'none';
                executionDetailsNotIntradayModal.style.display = 'none';
            } else if (showNotIntraday) {
                executionDetailsNotIntradayModal.style.display = 'block';
                executionDetailsIntradayModal.style.display = 'none';
                executionDetailsMultiIntradayModal.style.display = 'none';
            }
        }


        {% for execution in executions %}
            const intradayCheckboxModal_{{ execution.Id }} = document.getElementById('Intraday_Schedule_modal_{{ execution.Id }}');
            const notIntradayCheckboxModal_{{ execution.Id }} = document.getElementById('Is_not_Intraday_modal_{{ execution.Id }}');
            const multiIntradayCheckboxModal_{{ execution.Id }} = document.getElementById('Multi_Intraday_modal_{{ execution.Id }}');

            intradayCheckboxModal_{{ execution.Id }}.addEventListener('change', function () {
                if (this.checked) {
                    notIntradayCheckboxModal_{{ execution.Id }}.checked = false;
                    multiIntradayCheckboxModal_{{ execution.Id }}.checked = false;
                }
                toggleIntradayElementsModal({{ execution.Id }}, this.checked, multiIntradayCheckboxModal_{{ execution.Id }}.checked, notIntradayCheckboxModal_{{ execution.Id }}.checked);
            });

            notIntradayCheckboxModal_{{ execution.Id }}.addEventListener('change', function () {
                if (this.checked) {
                    intradayCheckboxModal_{{ execution.Id }}.checked = false;
                    multiIntradayCheckboxModal_{{ execution.Id }}.checked = false;
                }
                toggleIntradayElementsModal({{ execution.Id }}, intradayCheckboxModal_{{ execution.Id }}.checked, multiIntradayCheckboxModal_{{ execution.Id }}.checked, this.checked);
            });

            multiIntradayCheckboxModal_{{ execution.Id }}.addEventListener('change', function () {
                if (this.checked) {
                    intradayCheckboxModal_{{ execution.Id }}.checked = false;
                    notIntradayCheckboxModal_{{ execution.Id }}.checked = false;
                }
                toggleIntradayElementsModal({{ execution.Id }}, intradayCheckboxModal_{{ execution.Id }}.checked, this.checked, notIntradayCheckboxModal_{{ execution.Id }}.checked);
            });

            // This is the added line that ensures the right section is displayed upon the modal being loaded
            toggleIntradayElementsModal({{ execution.Id }}, intradayCheckboxModal_{{ execution.Id }}.checked, multiIntradayCheckboxModal_{{ execution.Id }}.checked, notIntradayCheckboxModal_{{ execution.Id }}.checked);
        {% endfor %}

    });
</script>



<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
        integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
        crossorigin="anonymous"></script>
<style>

    body {
        overflow-x: hidden;
        background-color: #212121;
        color: white;
    }
</style>
</html>